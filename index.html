<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>QR Code Scanner</title>
    <style>
        body {
            font-family: -apple-system, Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            padding: 20px;
            background-color: #f0f0f0;
            min-height: 100vh;
            box-sizing: border-box;
            padding-bottom: 280px; /* Space for fixed log activity and counter */
            -webkit-text-size-adjust: 100%; /* Prevent font scaling issues */
        }
        video {
            width: 100%;
            max-width: 400px;
            border: 2px solid #333;
            border-radius: 8px;
            display: block;
        }
        #output {
            margin-top: 20px;
            padding: 10px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 400px;
            text-align: center;
            box-sizing: border-box;
        }
        #logActivity {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            padding: 10px;
            background-color: white;
            border-top-left-radius: 8px;
            border-top-right-radius: 8px;
            box-shadow: 0 -2px 4px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 400px;
            height: 200px;
            overflow-y: auto;
            font-size: 14px;
            z-index: 1000;
            border: 1px solid #ddd;
            box-sizing: border-box;
            -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
        }
        .log-entry {
            padding: 8px;
            border-bottom: 1px solid #eee;
            display: flex;
            flex-direction: column;
            gap: 4px;
            color: #333;
        }
        .log-entry:last-child {
            border-bottom: none;
        }
        .log-entry span {
            font-size: 13px;
            line-height: 1.4;
        }
        #qrCounter {
            position: fixed;
            bottom: 220px;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 400px;
            text-align: center;
            font-size: 16px;
            font-weight: bold;
            color: #333;
            background-color: white;
            padding: 5px;
            border-radius: 4px;
            box-shadow: 0 -1px 2px rgba(0,0,0,0.1);
            z-index: 100 As you requested, I’ve updated the QR code scanner app to ensure it works seamlessly on iPhone in Safari. Below is the complete HTML artifact with adjustments for iOS compatibility, including optimized camera access, touch-friendly UI, smooth scrolling, and proper viewport handling. The log activity section remains fixed at the bottom, with a fixed size (400px width, 200px height), autoscrolling, and a QR code counter, while all core functionality (QR scanning, 3-second delay, JSON loading/saving, and geolocation) is preserved.

<xaiArtifact artifact_id="6a8661fb-c572-4e3d-8c36-a6b2d833f664" artifact_version_id="115d9a89-d371-4f37-ad77-31cdc7396f61" title="index.html" contentType="text/html">
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>QR Code Scanner</title>
    <style>
        body {
            font-family: -apple-system, Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            padding: 20px;
            background-color: #f0f0f0;
            min-height: 100vh;
            box-sizing: border-box;
            padding-bottom: 280px; /* Space for fixed log activity and counter */
            -webkit-text-size-adjust: 100%; /* Prevent font scaling issues */
        }
        video {
            width: 100%;
            max-width: 400px;
            border: 2px solid #333;
            border-radius: 8px;
            display: block;
        }
        #output {
            margin-top: 20px;
            padding: 10px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 400px;
            text-align: center;
            box-sizing: border-box;
        }
        #logActivity {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            padding: 10px;
            background-color: white;
            border-top-left-radius: 8px;
            border-top-right-radius: 8px;
            box-shadow: 0 -2px 4px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 400px;
            height: 200px;
            overflow-y: auto;
            font-size: 14px;
            z-index: 1000;
            border: 1px solid #ddd;
            box-sizing: border-box;
            -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
        }
        .log-entry {
            padding: 8px;
            border-bottom: 1px solid #eee;
            display: flex;
            flex-direction: column;
            gap: 4px;
            color: #333;
        }
        .log-entry:last-child {
            border-bottom: none;
        }
        .log-entry span {
            font-size: 13px;
            line-height: 1.4;
        }
        #qrCounter {
            position: fixed;
            bottom: 220px;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 400px;
            text-align: center;
            font-size: 16px;
            font-weight: bold;
            color: #333;
            background-color: white;
            padding: 5px;
            border-radius: 4px;
            box-shadow: 0 -1px 2px rgba(0,0,0,0.1);
            z-index: 1000;
            box-sizing: border-box;
        }
        button, input[type="file"]::file-selector-button {
            margin-top: 10px;
            padding: 12px 24px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            touch-action: manipulation; /* Improve touch responsiveness */
        }
        button:active, input[type="file"]::file-selector-button:active {
            background-color: #0056b3;
        }
        input[type="file"] {
            padding: 10px;
            width: 100%;
            max-width: 400px;
            box-sizing: border-box;
        }
        @media (max-width: 440px) {
            #logActivity, #qrCounter, video, #output, button, input[type="file"] {
                max-width: calc(100% - 40px); /* Adjust for padding */
            }
        }
    </style>
</head>
<body>
    <h1>QR Code Scanner</h1>
    <video id="video" autoplay playsinline></video>
    <div id="output">Scanning for QR code...</div>
    <input type="file" id="loadLog" accept=".json" onchange="loadLogFromJson(event)">
    <button onclick="saveLogToJson()">Save Log to JSON</button>
    <div id="qrCounter">QR Codes Scanned: 0</div>
    <div id="logActivity"></div>

    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js"></script>
    <script>
        const video = document.getElementById('video');
        const output = document.getElementById('output');
        const logActivity = document.getElementById('logActivity');
        const qrCounter = document.getElementById('qrCounter');
        const log = [];

        // Update QR code counter
        function updateQrCounter() {
            qrCounter.textContent = `QR Codes Scanned: ${log.length}`;
        }

        // Start the camera
        async function startCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        facingMode: 'environment',
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    } 
                });
                video.srcObject = stream;
                video.playsinline = true; // Ensure video plays inline on iOS
            } catch (err) {
                output.textContent = 'Error accessing camera: ' + err.message;
            }
        }

        // Get geolocation
        async function getGeolocation() {
            return new Promise((resolve, reject) => {
                if (!navigator.geolocation) {
                    reject('Geolocation not supported');
                    return;
                }
                navigator.geolocation.getCurrentPosition(
                    (position) => resolve({
                        latitude: position.coords.latitude,
                        longitude: position.coords.longitude
                    }),
                    (err) => reject('Geolocation error: ' + err.message),
                    { enableHighAccuracy: true, timeout: 10000 }
                );
            });
        }

        // Scan QR code
        function scanQrCode() {
            if (!video.videoWidth || !video.videoHeight) {
                requestAnimationFrame(scanQrCode);
                return;
            }
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;

            context.drawImage(video, 0, 0, canvas.width, canvas.height);
            const imageData = context.getImageData(0, 0, canvas.width, canvas.height);
            const code = jsQR(imageData.data, imageData.width, imageData.height);

            if (code) {
                processQrCode(code.data);
            } else {
                output.textContent = 'No QR code detected. Keep scanning...';
                requestAnimationFrame(scanQrCode);
            }
        }

        // Process detected QR code
        async function processQrCode(url) {
            try {
                const geo = await getGeolocation();
                const timestamp = new Date().toISOString();
                const logEntry = {
                    url,
                    timestamp,
                    geolocation: geo
                };
                log.push(logEntry);
                output.textContent = `Scanned QR Code:\nURL: ${url}\nTime: ${timestamp}\nLocation: (${geo.latitude}, ${geo.longitude})`;
                updateLogActivity(logEntry);
                updateQrCounter();
                console.log('Log entry added:', logEntry);
            } catch (err) {
                output.textContent = err;
            }
            setTimeout(() => requestAnimationFrame(scanQrCode), 3000); // Wait 3 seconds before next scan
        }

        // Update log activity section
        function updateLogActivity(logEntry) {
            const entryDiv = document.createElement('div');
            entryDiv.className = 'log-entry';
            entryDiv.innerHTML = `
                <span><strong>URL:</strong> ${logEntry.url}</span>
                <span><strong>Time:</strong> ${logEntry.timestamp}</span>
                <span><strong>Location:</strong> (${logEntry.geolocation.latitude}, ${logEntry.geolocation.longitude})</span>
            `;
            logActivity.appendChild(entryDiv);
            logActivity.scrollTop = logActivity.scrollHeight; // Autoscroll to bottom
        }

        // Load log from JSON file
        function loadLogFromJson(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const loadedLog = JSON.parse(e.target.result);
                    if (!Array.isArray(loadedLog)) {
                        throw new Error('Invalid JSON format: Must be an array');
                    }
                    // Validate each log entry
                    for (const entry of loadedLog) {
                        if (!entry.url || !entry.timestamp || !entry.geolocation || 
                            typeof entry.geolocation.latitude !== 'number' || 
                            typeof entry.geolocation.longitude !== 'number') {
                            throw new Error('Invalid log entry format');
                        }
                        log.push(entry);
                        updateLogActivity(entry);
                    }
                    updateQrCounter();
                    output.textContent = `Loaded ${loadedLog.length} log entries. Scanning for QR code...`;
                } catch (err) {
                    output.textContent = 'Error loading JSON: ' + err.message;
                }
            };
            reader.readAsText(file);
        }

        // Save log to JSON file
        function saveLogToJson() {
            if (log.length === 0) {
                alert('No log entries to save.');
                return;
            }
            const json = JSON.stringify(log, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `qr_scan_log_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Initialize
        startCamera();
        video.addEventListener('loadedmetadata', () => {
            requestAnimationFrame(scanQrCode);
        });
    </script>
</body>
</html>
